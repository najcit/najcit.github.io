---
title: 如何学习 Redis (II)
published: true
categories: [program]
tags: [redis]
---

Redis 线程模型  
> Redis 基于 Reactor 模式开发了网络事件处理器，这个处理器被称为文件事件处理器（file event handler）。它的组成结构为4部分：多个套接字、IO多路复用程序、文件事件分派器、事件处理器。因为文件事件分派器队列的消费是单线程的，所以Redis才叫单线程模型。  
> 文件事件处理器使用 I/O 多路复用（multiplexing）程序来同时监听多个套接字， 并根据套接字目前执行的任务来为套接字关联不同的事件处理器。  
> 当被监听的套接字准备好执行连接应答（accept）、读取（read）、写入（write）、关闭（close）等操作时， 与操作相对应的文件事件就会产生， 这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。  
> 虽然文件事件处理器以单线程方式运行， 但通过使用 I/O 多路复用程序来监听多个套接字， 文件事件处理器既实现了高性能的网络通信模型， 又可以很好地与 redis 服务器中其他同样以单线程方式运行的模块进行对接， 这保持了 Redis 内部单线程设计的简单性。

Redis 缓存过期策略  
> Redis 通常有以下3种:定时过期、惰性过期和定期过期。  
> Redis 中同时使用了惰性过期和定期过期两种过期策略。
> 1. 定时过期： 每个key都会设置一个过期时间和一个定时器，到期时间就会立即清除。该策略可以立即处理过期的key,对内存友好，但会占用大量的CPU资源处理过期的key，从而影响系统的性能
> 2. 惰性过期：只有访问一个key时，才会检查key是否过期，过期则清除。该策略可以最大化的节省CPU	资源，却对内存不友好，极端情况可能出现大量的过期key没有被访问，从而不会立即清除，而占用大量内存。
> 3. 定期过期：每隔一定时间，会扫描一定的key的过期时间，并清除其中已过期的key。通过调整定时扫描的时间间隔和每次扫描的限定耗时，可以在不同情况下使得CPU和内存资源达到最优的平衡效果。  

Redis 缓存淘汰策略  
> Redis 的内存淘汰策略是指在Redis的用于缓存的内存不足时，怎么处理需要新写入且需要申请额外空间的数据。
> 1. 全局的键空间选择性移除
	1. noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。
    2. allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key。
    3. allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。
> 2. 设置过期时间的键空间选择性移除
    1. volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。
    2. volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。
    3. volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，较早过期时间的key优先移除。
